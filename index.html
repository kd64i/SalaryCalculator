<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–ªèµ„å®æ—¶è®¡ç®—å™¨</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --holiday: #ff6b6b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }
        
        .content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
        }
        
        .card h3 i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--success);
            border-radius: 5px;
            transition: width 0.5s;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .btn {
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-waiting {
            background: #ff9e00;
        }
        
        .btn-waiting:hover {
            background: #e08d00;
        }
        
        .btn-working {
            background: var(--warning);
        }
        
        .btn-working:hover {
            background: #e01a6f;
        }
        
        .btn-reset {
            background: #6c757d;
        }
        
        .btn-reset:hover {
            background: #5a6268;
        }
        
        .overtime-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            align-items: center;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-right: 10px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .refresh-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .refresh-input {
            width: 100px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .status-waiting {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-working {
            background: #d4edda;
            color: #155724;
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .overtime-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è–ªèµ„å®æ—¶è®¡ç®—å™¨</h1>
            <p class="subtitle">å®æ—¶è¿½è¸ªæ‚¨çš„æ”¶å…¥ï¼Œè®©æ¯ä¸€ç§’çš„åŠªåŠ›éƒ½çœ‹å¾—è§</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="income">æ”¶å…¥æ¦‚è§ˆ</div>
            <div class="tab" data-tab="settings">è®¾ç½®</div>
        </div>
        
        <div id="income" class="content active">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">ä»Šæ—¥å®æ—¶æ”¶å…¥</div>
                    <div class="stat-value" id="today-income">Â¥0.00</div>
                    <div class="progress-bar">
                        <div class="progress" id="today-progress" style="width: 0%"></div>
                    </div>
                    <div>å·²å®Œæˆ: <span id="work-progress">0%</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">æœ¬æœˆç´¯è®¡æ”¶å…¥</div>
                    <div class="stat-value" id="month-income">Â¥0.00</div>
                    <div>å·¥ä½œæ—¥: <span id="work-days">0/0</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">ä¸‹ç­å€’è®¡æ—¶</div>
                    <div class="stat-value" id="countdown">00:00:00</div>
                    <div>çŠ¶æ€: <span id="work-status">æœªä¸Šç­</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">æœ¬æ—¥åŠ ç­æ”¶å…¥</div>
                    <div class="stat-value" id="overtime-income">Â¥0.00</div>
                    <div>åŠ ç­æ—¶é•¿: <span id="overtime-duration">00:00:00</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">æœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥</div>
                    <div class="stat-value" id="month-overtime-income">Â¥0.00</div>
                    <div class="stat-label">æœ¬æœˆç´¯è®¡</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i>â°â°â°</i> åŠ ç­æ§åˆ¶</h3>
                <div class="overtime-controls">
                    <button id="overtime-btn" class="btn">
                        <i>âš¡âš¡</i> åŠ ç­
                    </button>
                    <button id="reset-overtime" class="btn btn-reset">
                        <i>ğŸ”„</i> é‡ç½®åŠ ç­æ”¶å…¥
                    </button>
                    <div>
                        <p>åŠ ç­çŠ¶æ€: <span id="overtime-status">æœªåŠ ç­</span></p>
                        <p>åŠ ç­æ—¶è–ª: <span id="overtime-rate-display">Â¥0.00</span>/å°æ—¶</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3><i>ğŸ“ŠğŸ“Š</i> æœ¬æœˆç»Ÿè®¡</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">å·²å·¥ä½œå¤©æ•°</div>
                        <div class="stat-value" id="worked-days">0</div>
                        <div class="stat-label">æœ¬æœˆæ€»å·¥ä½œæ—¥</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ä¼‘æ¯å¤©æ•°</div>
                        <div class="stat-value" id="rest-days">0</div>
                        <div class="stat-label">æœ¬æœˆå‰©ä½™</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æœ¬æœˆæ”¶å…¥è¿›åº¦</div>
                        <div class="stat-value" id="month-progress">0%</div>
                        <div class="stat-label">å·²å®Œæˆ/ç›®æ ‡</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings" class="content">
            <div class="card">
                <h3><i>âš™âš™ï¸</i> åŸºæœ¬è®¾ç½®</h3>
                <div class="form-group">
                    <label for="monthly-salary">æœˆè–ª (å…ƒ)</label>
                    <input type="number" id="monthly-salary" value="10000" min="0">
                </div>
                
                <div class="form-group">
                    <label for="work-days-month">æ¯æœˆå·¥ä½œå¤©æ•°</label>
                    <input type="number" id="work-days-month" value="22" min="1" max="31">
                </div>
                
                <div class="form-group">
                    <label for="work-hours-day">æ¯æ—¥å·¥ä½œå°æ—¶</label>
                    <input type="number" id="work-hours-day" value="8" min="1" max="24" step="0.5">
                </div>
                
                <div class="form-group">
                    <label for="work-start">ä¸Šç­æ—¶é—´</label>
                    <input type="time" id="work-start" value="09:00">
                </div>
                
                <div class="form-group">
                    <label for="work-end">ä¸‹ç­æ—¶é—´</label>
                    <input type="time" id="work-end" value="18:00">
                </div>
                
                <div class="form-group">
                    <label for="overtime-rate">åŠ ç­æ—¶è–ª (å…ƒ/å°æ—¶)</label>
                    <input type="number" id="overtime-rate" value="60" min="0">
                </div>
                
                <div class="form-group">
                    <div class="toggle-container">
                        <label class="toggle">
                            <input type="checkbox" id="enable-overtime-end">
                            <span class="slider"></span>
                        </label>
                        <label for="enable-overtime-end">è®¾ç½®åŠ ç­ç»“æŸæ—¶é—´</label>
                    </div>
                    <input type="time" id="overtime-end" value="20:00" style="margin-top: 10px;">
                </div>
            </div>
            
            <div class="card">
                <h3><i>ğŸ”„ğŸ”„</i> æ˜¾ç¤ºè®¾ç½®</h3>
                <div class="form-group">
                    <label for="refresh-interval">æ•°æ®åˆ·æ–°é¢‘ç‡ (ç§’)</label>
                    <div class="refresh-controls">
                        <input type="number" id="refresh-interval" value="1" min="1" max="60" class="refresh-input">
                        <button id="apply-refresh" class="btn">åº”ç”¨åˆ·æ–°é¢‘ç‡</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3><i>ğŸ’¾ğŸ’¾</i> æ•°æ®ç®¡ç†</h3>
                <button id="save-settings" class="btn"><i>ğŸ’¾ğŸ’¾</i> ä¿å­˜è®¾ç½®</button>
                <button id="reset-data" class="btn" style="background: var(--warning); margin-left: 10px;"><i>ğŸ”„ğŸ”„</i> é‡ç½®æ•°æ®</button>
                <button id="export-data" class="btn" style="background: var(--success); margin-left: 10px;"><i>ğŸ“¤ğŸ“¤</i> å¯¼å‡ºæ•°æ®</button>
                <button id="import-data" class="btn" style="background: #20c997; margin-left: 10px;"><i>ğŸ“¥ğŸ“¥</i> å¯¼å…¥æ•°æ®</button>
                <input type="file" id="file-input" class="file-input" accept=".json">
            </div>
        </div>
        
        <footer>
            <p>è–ªèµ„å®æ—¶è®¡ç®—å™¨ &copy; 2025 - è®©å·¥ä½œä»·å€¼å¯è§†åŒ–</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let refreshInterval = 1000; // é»˜è®¤1ç§’åˆ·æ–°
        let refreshTimer = null;
        let overtimeStatus = 'none'; // none, waiting, working
        let overtimeStartTime = null;
        let overtimeEndTime = null;
        let overtimeIncome = 0;
        let monthOvertimeIncome = 0; // æœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥
        let workStartTime = null;
        let workEndTime = null;
        let currentDate = new Date();
        let lastResetDate = new Date().getDate();
        let lastMonthReset = new Date().getMonth(); // è®°å½•ä¸Šä¸ªæœˆä»½ï¼Œç”¨äºè·¨æœˆé‡ç½®
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            loadSettings();
            setupEventListeners();
            startRefreshing();
            updateDisplay();
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('salaryCalculatorSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('monthly-salary').value = settings.monthlySalary || 10000;
                document.getElementById('work-days-month').value = settings.workDaysMonth || 22;
                document.getElementById('work-hours-day').value = settings.workHoursDay || 8;
                document.getElementById('work-start').value = settings.workStart || '09:00';
                document.getElementById('work-end').value = settings.workEnd || '18:00';
                document.getElementById('overtime-rate').value = settings.overtimeRate || 60;
                document.getElementById('refresh-interval').value = settings.refreshInterval || 1;
                document.getElementById('enable-overtime-end').checked = settings.enableOvertimeEnd || false;
                document.getElementById('overtime-end').value = settings.overtimeEnd || '20:00';
                
                refreshInterval = (settings.refreshInterval || 1) * 1000;
            }
            
            // åŠ è½½åŠ ç­æ•°æ®
            const overtimeData = localStorage.getItem('overtimeData');
            if (overtimeData) {
                const data = JSON.parse(overtimeData);
                overtimeStatus = data.overtimeStatus || 'none';
                overtimeStartTime = data.overtimeStartTime ? new Date(data.overtimeStartTime) : null;
                overtimeEndTime = data.overtimeEndTime ? new Date(data.overtimeEndTime) : null;
                overtimeIncome = data.overtimeIncome || 0;
                monthOvertimeIncome = data.monthOvertimeIncome || 0;
                lastResetDate = data.lastResetDate || new Date().getDate();
                lastMonthReset = data.lastMonthReset || new Date().getMonth();
            }
            
            // åº”ç”¨åˆ·æ–°é¢‘ç‡
            applyRefreshInterval();
            
            // æ›´æ–°åŠ ç­ç»“æŸæ—¶é—´è¾“å…¥æ¡†çŠ¶æ€
            updateOvertimeEndInput();
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const settings = {
                monthlySalary: parseInt(document.getElementById('monthly-salary').value),
                workDaysMonth: parseInt(document.getElementById('work-days-month').value),
                workHoursDay: parseFloat(document.getElementById('work-hours-day').value),
                workStart: document.getElementById('work-start').value,
                workEnd: document.getElementById('work-end').value,
                overtimeRate: parseInt(document.getElementById('overtime-rate').value),
                refreshInterval: parseInt(document.getElementById('refresh-interval').value),
                enableOvertimeEnd: document.getElementById('enable-overtime-end').checked,
                overtimeEnd: document.getElementById('overtime-end').value
            };
            
            localStorage.setItem('salaryCalculatorSettings', JSON.stringify(settings));
            
            // ä¿å­˜åŠ ç­æ•°æ®
            const overtimeData = {
                overtimeStatus: overtimeStatus,
                overtimeStartTime: overtimeStartTime,
                overtimeEndTime: overtimeEndTime,
                overtimeIncome: overtimeIncome,
                monthOvertimeIncome: monthOvertimeIncome,
                lastResetDate: lastResetDate,
                lastMonthReset: lastMonthReset
            };
            localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
            
            alert('è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é€‰é¡¹å¡åˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
                });
            });
            
            // åŠ ç­æŒ‰é’®
            document.getElementById('overtime-btn').addEventListener('click', toggleOvertime);
            
            // é‡ç½®åŠ ç­æ”¶å…¥æŒ‰é’®
            document.getElementById('reset-overtime').addEventListener('click', resetOvertimeIncome);
            
            // åº”ç”¨åˆ·æ–°é¢‘ç‡
            document.getElementById('apply-refresh').addEventListener('click', applyRefreshInterval);
            
            // ä¿å­˜è®¾ç½®
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            
            // é‡ç½®æ•°æ®
            document.getElementById('reset-data').addEventListener('click', resetData);
            
            // å¯¼å‡ºæ•°æ®
            document.getElementById('export-data').addEventListener('click', exportData);
            
            // å¯¼å…¥æ•°æ®
            document.getElementById('import-data').addEventListener('click', () => {
                document.getElementById('file-input').click();
            });
            
            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            document.getElementById('file-input').addEventListener('change', importData);
            
            // åŠ ç­ç»“æŸæ—¶é—´è®¾ç½®
            document.getElementById('enable-overtime-end').addEventListener('change', updateOvertimeEndInput);
            
            // è®¾ç½®å˜åŒ–æ—¶å®æ—¶æ›´æ–°æ˜¾ç¤º
            document.querySelectorAll('#settings input').forEach(input => {
                input.addEventListener('change', updateDisplay);
            });
        }
        
        // æ›´æ–°åŠ ç­ç»“æŸæ—¶é—´è¾“å…¥æ¡†çŠ¶æ€
        function updateOvertimeEndInput() {
            const enabled = document.getElementById('enable-overtime-end').checked;
            document.getElementById('overtime-end').disabled = !enabled;
        }
        
        // åº”ç”¨åˆ·æ–°é—´éš”
        function applyRefreshInterval() {
            const intervalSeconds = parseInt(document.getElementById('refresh-interval').value);
            refreshInterval = Math.max(1, Math.min(60, intervalSeconds)) * 1000;
            
            if (refreshTimer) {
                clearInterval(refreshTimer);
            }
            startRefreshing();
        }
        
        // å¼€å§‹åˆ·æ–°
        function startRefreshing() {
            refreshTimer = setInterval(updateDisplay, refreshInterval);
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            checkDateChange();
            updateIncome();
            updateCountdown();
            updateOvertime();
            updateCalendarStats();
            checkOvertimeEndTime(); // æ£€æŸ¥åŠ ç­ç»“æŸæ—¶é—´
        }
        
        // æ£€æŸ¥åŠ ç­ç»“æŸæ—¶é—´
        function checkOvertimeEndTime() {
            if (overtimeStatus === 'working' && document.getElementById('enable-overtime-end').checked) {
                const now = new Date();
                const overtimeEnd = document.getElementById('overtime-end').value;
                const overtimeEndTime = new Date(now);
                overtimeEndTime.setHours(parseInt(overtimeEnd.split(':')[0]), parseInt(overtimeEnd.split(':')[1]), 0, 0);
                
                // å¦‚æœå½“å‰æ—¶é—´è¶…è¿‡åŠ ç­ç»“æŸæ—¶é—´ï¼Œè‡ªåŠ¨ç»“æŸåŠ ç­
                if (now >= overtimeEndTime) {
                    endOvertimeAutomatically();
                }
            }
        }
        
        // è‡ªåŠ¨ç»“æŸåŠ ç­
        function endOvertimeAutomatically() {
            if (overtimeStatus === 'working') {
                const now = new Date();
                const overtimeEnd = document.getElementById('overtime-end').value;
                const overtimeEndTime = new Date(now);
                overtimeEndTime.setHours(parseInt(overtimeEnd.split(':')[0]), parseInt(overtimeEnd.split(':')[1]), 0, 0);
                
                // è®¡ç®—åŠ ç­æ”¶å…¥
                const overtimeRate = parseInt(document.getElementById('overtime-rate').value);
                const overtimeSeconds = Math.min((overtimeEndTime - overtimeStartTime) / 1000, (now - overtimeStartTime) / 1000);
                const currentOvertimeIncome = overtimeSeconds * (overtimeRate / 3600);
                
                // æ›´æ–°ä»Šæ—¥åŠ ç­æ”¶å…¥å’Œæœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥
                overtimeIncome += currentOvertimeIncome;
                monthOvertimeIncome += currentOvertimeIncome;
                
                // ç»“æŸåŠ ç­
                overtimeStatus = 'none';
                overtimeStartTime = null;
                overtimeEndTime = now;
                
                // ä¿å­˜çŠ¶æ€
                const overtimeData = {
                    overtimeStatus: overtimeStatus,
                    overtimeStartTime: overtimeStartTime,
                    overtimeEndTime: overtimeEndTime,
                    overtimeIncome: overtimeIncome,
                    monthOvertimeIncome: monthOvertimeIncome,
                    lastResetDate: lastResetDate,
                    lastMonthReset: lastMonthReset
                };
                localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
                
                alert('å·²åˆ°è¾¾è®¾ç½®çš„åŠ ç­ç»“æŸæ—¶é—´ï¼ŒåŠ ç­å·²è‡ªåŠ¨ç»“æŸã€‚');
            }
        }
        
        // æ£€æŸ¥æ—¥æœŸå˜åŒ–
        function checkDateChange() {
            const now = new Date();
            const currentDay = now.getDate();
            const currentMonth = now.getMonth();
            
            // å¦‚æœæ—¥æœŸå˜åŒ–ä¸”ä¸æ˜¯åŒä¸€å¤©ï¼Œé‡ç½®åŠ ç­æ”¶å…¥
            if (currentDay !== lastResetDate) {
                overtimeIncome = 0;
                overtimeStatus = 'none';
                overtimeStartTime = null;
                overtimeEndTime = null;
                lastResetDate = currentDay;
                
                // å¦‚æœæœˆä»½å˜åŒ–ï¼Œé‡ç½®æœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥
                if (currentMonth !== lastMonthReset) {
                    monthOvertimeIncome = 0;
                    lastMonthReset = currentMonth;
                }
                
                // ä¿å­˜é‡ç½®åçš„æ•°æ®
                const overtimeData = {
                    overtimeStatus: overtimeStatus,
                    overtimeStartTime: overtimeStartTime,
                    overtimeEndTime: overtimeEndTime,
                    overtimeIncome: overtimeIncome,
                    monthOvertimeIncome: monthOvertimeIncome,
                    lastResetDate: lastResetDate,
                    lastMonthReset: lastMonthReset
                };
                localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
            }
        }
        
        // æ›´æ–°æ”¶å…¥ä¿¡æ¯
        function updateIncome() {
            const monthlySalary = parseInt(document.getElementById('monthly-salary').value);
            const workDaysMonth = parseInt(document.getElementById('work-days-month').value);
            const workHoursDay = parseFloat(document.getElementById('work-hours-day').value);
            const workStart = document.getElementById('work-start').value;
            const workEnd = document.getElementById('work-end').value;
            const overtimeRate = parseInt(document.getElementById('overtime-rate').value);
            
            // è®¡ç®—æ—¶è–ª
            const dailyRate = monthlySalary / workDaysMonth;
            const hourlyRate = dailyRate / workHoursDay;
            const secondRate = hourlyRate / 3600;
            
            // è®¡ç®—ä»Šæ—¥æ”¶å…¥
            const now = new Date();
            const todayStart = new Date(now);
            todayStart.setHours(parseInt(workStart.split(':')[0]), parseInt(workStart.split(':')[1]), 0, 0);
            
            const todayEnd = new Date(now);
            todayEnd.setHours(parseInt(workEnd.split(':')[0]), parseInt(workEnd.split(':')[1]), 0, 0);
            
            // è®¡ç®—ä»Šæ—¥å·¥ä½œç§’æ•°
            let workedSeconds = 0;
            if (now >= todayStart && now <= todayEnd) {
                workedSeconds = (now - todayStart) / 1000;
            } else if (now > todayEnd) {
                workedSeconds = (todayEnd - todayStart) / 1000;
            }
            
            // è®¡ç®—æ­£å¸¸å·¥ä½œæ—¶é—´æ”¶å…¥
            const todayNormalIncome = workedSeconds * secondRate;
            
            // è®¡ç®—åŠ ç­æ”¶å…¥
            let currentOvertimeIncome = overtimeIncome;
            if (overtimeStatus === 'working' && overtimeStartTime) {
                const overtimeEnd = calculateOvertimeEndTime(now);
                const overtimeSeconds = Math.min((now - overtimeStartTime) / 1000, (overtimeEnd - overtimeStartTime) / 1000);
                currentOvertimeIncome = overtimeIncome + (overtimeSeconds * (overtimeRate / 3600));
            }
            
            // ä»Šæ—¥æ€»æ”¶å…¥ = æ­£å¸¸æ”¶å…¥ + åŠ ç­æ”¶å…¥
            const todayIncome = todayNormalIncome + currentOvertimeIncome;
            document.getElementById('today-income').textContent = `Â¥${todayIncome.toFixed(2)}`;
            
            // æ›´æ–°è¿›åº¦æ¡
            const totalWorkSeconds = (todayEnd - todayStart) / 1000;
            const progressPercent = totalWorkSeconds > 0 ? (workedSeconds / totalWorkSeconds) * 100 : 0;
            document.getElementById('today-progress').style.width = `${Math.min(progressPercent, 100)}%`;
            document.getElementById('work-progress').textContent = `${Math.min(progressPercent, 100).toFixed(1)}%`;
            
            // è®¡ç®—æœ¬æœˆæ”¶å…¥ï¼ˆåªè®¡ç®—å·¥ä½œæ—¥ï¼Œæ’é™¤å‘¨æœ«ï¼‰
            const currentDay = now.getDate();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // è®¡ç®—æœ¬æœˆå·²è¿‡å»çš„å·¥ä½œæ—¥ï¼ˆæ’é™¤å‘¨æœ«ï¼‰
            let workedDaysThisMonth = 0;
            for (let day = 1; day <= currentDay; day++) {
                const date = new Date(currentYear, currentMonth, day);
                // 0æ˜¯å‘¨æ—¥ï¼Œ6æ˜¯å‘¨å…­
                if (date.getDay() !== 0 && date.getDay() !== 6) {
                    workedDaysThisMonth++;
                }
            }
            
            // æœ¬æœˆæ­£å¸¸æ”¶å…¥ = å·²å·¥ä½œå¤©æ•° * æ—¥è–ª
            const monthNormalIncome = workedDaysThisMonth * dailyRate;
            
            // æœ¬æœˆæ€»æ”¶å…¥ = æœ¬æœˆæ­£å¸¸æ”¶å…¥ + æœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥ + å½“å‰åŠ ç­æ”¶å…¥
            const monthIncome = monthNormalIncome + monthOvertimeIncome + (overtimeStatus === 'working' ? currentOvertimeIncome - overtimeIncome : 0);
            document.getElementById('month-income').textContent = `Â¥${monthIncome.toFixed(2)}`;
            
            // æ›´æ–°å·¥ä½œæ—¥ä¿¡æ¯
            document.getElementById('work-days').textContent = `${workedDaysThisMonth}/${workDaysMonth}`;
            
            // æ›´æ–°åŠ ç­æ—¶è–ªæ˜¾ç¤º
            document.getElementById('overtime-rate-display').textContent = `Â¥${overtimeRate.toFixed(2)}`;
            
            // æ›´æ–°åŠ ç­æ”¶å…¥æ˜¾ç¤º
            document.getElementById('overtime-income').textContent = `Â¥${currentOvertimeIncome.toFixed(2)}`;
            
            // æ›´æ–°æœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥æ˜¾ç¤ºï¼ˆåŒ…æ‹¬å½“å‰æ­£åœ¨è¿›è¡Œçš„åŠ ç­æ”¶å…¥ï¼‰
            const currentMonthOvertimeIncome = monthOvertimeIncome + (overtimeStatus === 'working' ? currentOvertimeIncome - overtimeIncome : 0);
            document.getElementById('month-overtime-income').textContent = `Â¥${currentMonthOvertimeIncome.toFixed(2)}`;
        }
        
        // æ›´æ–°å€’è®¡æ—¶
        function updateCountdown() {
            const workEnd = document.getElementById('work-end').value;
            const now = new Date();
            
            const todayEnd = new Date(now);
            todayEnd.setHours(parseInt(workEnd.split(':')[0]), parseInt(workEnd.split(':')[1]), 0, 0);
            
            let timeLeft = todayEnd - now;
            let status = "å·¥ä½œä¸­";
            
            if (timeLeft <= 0) {
                timeLeft = 0;
                status = "å·²ä¸‹ç­";
                
                if (overtimeStatus === 'waiting') {
                    // å¦‚æœæ˜¯åœ¨ç­‰å¾…çŠ¶æ€ä¸”å·²ä¸‹ç­ï¼Œåˆ‡æ¢åˆ°å·¥ä½œçŠ¶æ€
                    overtimeStatus = 'working';
                    overtimeStartTime = todayEnd; // ä»ä¸‹ç­æ—¶é—´å¼€å§‹è®¡ç®—
                    
                    // ä¿å­˜çŠ¶æ€
                    const overtimeData = {
                        overtimeStatus: overtimeStatus,
                        overtimeStartTime: overtimeStartTime,
                        overtimeEndTime: overtimeEndTime,
                        overtimeIncome: overtimeIncome,
                        monthOvertimeIncome: monthOvertimeIncome,
                        lastResetDate: lastResetDate,
                        lastMonthReset: lastMonthReset
                    };
                    localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
                } else if (overtimeStatus === 'working') {
                    status = "åŠ ç­ä¸­";
                }
            } else if (now < new Date(now.getFullYear(), now.getMonth(), now.getDate(), 
                                     parseInt(document.getElementById('work-start').value.split(':')[0]), 
                                     parseInt(document.getElementById('work-start').value.split(':')[1]))) {
                status = "æœªä¸Šç­";
            }
            
            // æ ¼å¼åŒ–æ—¶é—´
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('work-status').textContent = status;
        }
        
        // æ›´æ–°åŠ ç­ä¿¡æ¯
        function updateOvertime() {
            const overtimeRate = parseInt(document.getElementById('overtime-rate').value);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€å’Œæ˜¾ç¤º
            if (overtimeStatus === 'none') {
                document.getElementById('overtime-btn').className = 'btn';
                document.getElementById('overtime-btn').innerHTML = '<i>âš¡âš¡</i> åŠ ç­';
                document.getElementById('overtime-status').textContent = 'æœªåŠ ç­';
                document.getElementById('overtime-duration').textContent = '00:00:00';
            } else if (overtimeStatus === 'waiting') {
                document.getElementById('overtime-btn').className = 'btn btn-waiting';
                document.getElementById('overtime-btn').innerHTML = '<i>â³â³â³</i> ç­‰å¾…åŠ ç­';
                document.getElementById('overtime-status').innerHTML = 'ç­‰å¾…ä¸‹ç­ <span class="status-badge status-waiting">ç­‰å¾…ä¸­</span>';
                document.getElementById('overtime-duration').textContent = '00:00:00';
            } else if (overtimeStatus === 'working') {
                document.getElementById('overtime-btn').className = 'btn btn-working';
                document.getElementById('overtime-btn').innerHTML = '<i>â¹â¹â¹ï¸</i> ç»“æŸåŠ ç­';
                document.getElementById('overtime-status').innerHTML = 'åŠ ç­ä¸­ <span class="status-badge status-working">è¿›è¡Œä¸­</span>';
                
                // è®¡ç®—åŠ ç­æ—¶é•¿
                const now = new Date();
                const overtimeEnd = calculateOvertimeEndTime(now);
                const overtimeSeconds = Math.min((now - overtimeStartTime) / 1000, (overtimeEnd - overtimeStartTime) / 1000);
                
                // æ ¼å¼åŒ–æ—¶é—´
                const hours = Math.floor(overtimeSeconds / 3600);
                const minutes = Math.floor((overtimeSeconds % 3600) / 60);
                const seconds = Math.floor(overtimeSeconds % 60);
                
                document.getElementById('overtime-duration').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // è®¡ç®—åŠ ç­ç»“æŸæ—¶é—´
        function calculateOvertimeEndTime(now) {
            const enableOvertimeEnd = document.getElementById('enable-overtime-end').checked;
            
            if (!enableOvertimeEnd) {
                // å¦‚æœæ²¡æœ‰è®¾ç½®åŠ ç­ç»“æŸæ—¶é—´ï¼Œè¿”å›ä¸€ä¸ªå¾ˆè¿œçš„æœªæ¥æ—¶é—´
                return new Date(now.getFullYear() + 10, 0, 1);
            }
            
            const overtimeEnd = document.getElementById('overtime-end').value;
            const overtimeEndTime = new Date(now);
            overtimeEndTime.setHours(parseInt(overtimeEnd.split(':')[0]), parseInt(overtimeEnd.split(':')[1]), 0, 0);
            
            return overtimeEndTime;
        }
        
        // åˆ‡æ¢åŠ ç­çŠ¶æ€
        function toggleOvertime() {
            const now = new Date();
            const workEnd = document.getElementById('work-end').value;
            const todayEnd = new Date(now);
            todayEnd.setHours(parseInt(workEnd.split(':')[0]), parseInt(workEnd.split(':')[1]), 0, 0);
            
            if (overtimeStatus === 'none') {
                // å¦‚æœæœªä¸‹ç­ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å¦‚æœå·²ä¸‹ç­ï¼Œç›´æ¥è¿›å…¥å·¥ä½œçŠ¶æ€
                if (now < todayEnd) {
                    overtimeStatus = 'waiting';
                } else {
                    overtimeStatus = 'working';
                    overtimeStartTime = todayEnd;
                }
            } else {
                // ç»“æŸåŠ ç­
                if (overtimeStatus === 'working') {
                    // ä¿å­˜å½“å‰çš„åŠ ç­æ”¶å…¥
                    const overtimeRate = parseInt(document.getElementById('overtime-rate').value);
                    const overtimeEnd = calculateOvertimeEndTime(now);
                    const overtimeSeconds = Math.min((now - overtimeStartTime) / 1000, (overtimeEnd - overtimeStartTime) / 1000);
                    const currentOvertimeIncome = overtimeSeconds * (overtimeRate / 3600);
                    
                    // æ›´æ–°ä»Šæ—¥åŠ ç­æ”¶å…¥å’Œæœ¬æœˆç´¯è®¡åŠ ç­æ”¶å…¥
                    overtimeIncome += currentOvertimeIncome;
                    monthOvertimeIncome += currentOvertimeIncome;
                    
                    overtimeEndTime = now;
                }
                
                overtimeStatus = 'none';
                overtimeStartTime = null;
            }
            
            // ä¿å­˜çŠ¶æ€
            const overtimeData = {
                overtimeStatus: overtimeStatus,
                overtimeStartTime: overtimeStartTime,
                overtimeEndTime: overtimeEndTime,
                overtimeIncome: overtimeIncome,
                monthOvertimeIncome: monthOvertimeIncome,
                lastResetDate: lastResetDate,
                lastMonthReset: lastMonthReset
            };
            localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
            
            updateOvertime();
        }
        
        // é‡ç½®åŠ ç­æ”¶å…¥
        function resetOvertimeIncome() {
            if (confirm('ç¡®å®šè¦é‡ç½®æœ¬æ—¥åŠ ç­æ”¶å…¥å—ï¼Ÿè¿™å°†æ¸…é™¤ä»Šæ—¥çš„åŠ ç­æ”¶å…¥è®°å½•ã€‚')) {
                overtimeIncome = 0;
                
                // ä¿å­˜çŠ¶æ€
                const overtimeData = {
                    overtimeStatus: overtimeStatus,
                    overtimeStartTime: overtimeStartTime,
                    overtimeEndTime: overtimeEndTime,
                    overtimeIncome: overtimeIncome,
                    monthOvertimeIncome: monthOvertimeIncome,
                    lastResetDate: lastResetDate,
                    lastMonthReset: lastMonthReset
                };
                localStorage.setItem('overtimeData', JSON.stringify(overtimeData));
                
                updateDisplay();
            }
        }
        
        // æ›´æ–°æœ¬æœˆç»Ÿè®¡
        function updateCalendarStats() {
            const now = new Date();
            const currentDay = now.getDate();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const workDaysMonth = parseInt(document.getElementById('work-days-month').value);
            const monthlySalary = parseInt(document.getElementById('monthly-salary').value);
            
            // è®¡ç®—æœ¬æœˆå·²è¿‡å»çš„å·¥ä½œæ—¥ï¼ˆæ’é™¤å‘¨æœ«ï¼‰
            let workedDaysThisMonth = 0;
            for (let day = 1; day <= currentDay; day++) {
                const date = new Date(currentYear, currentMonth, day);
                // 0æ˜¯å‘¨æ—¥ï¼Œ6æ˜¯å‘¨å…­
                if (date.getDay() !== 0 && date.getDay() !== 6) {
                    workedDaysThisMonth++;
                }
            }
            
            // è®¡ç®—æœ¬æœˆå‰©ä½™å·¥ä½œæ—¥
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            let restDaysThisMonth = 0;
            for (let day = currentDay + 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                // 0æ˜¯å‘¨æ—¥ï¼Œ6æ˜¯å‘¨å…­
                if (date.getDay() !== 0 && date.getDay() !== 6) {
                    restDaysThisMonth++;
                }
            }
            
            // è®¡ç®—æœ¬æœˆæ”¶å…¥è¿›åº¦
            const dailyRate = monthlySalary / workDaysMonth;
            const monthNormalIncome = workedDaysThisMonth * dailyRate;
            const overtimeRate = parseInt(document.getElementById('overtime-rate').value);
            
            // è®¡ç®—å½“å‰åŠ ç­æ”¶å…¥
            let currentOvertimeIncome = overtimeIncome;
            if (overtimeStatus === 'working' && overtimeStartTime) {
                const now = new Date();
                const overtimeEnd = calculateOvertimeEndTime(now);
                const overtimeSeconds = Math.min((now - overtimeStartTime) / 1000, (overtimeEnd - overtimeStartTime) / 1000);
                currentOvertimeIncome = overtimeIncome + (overtimeSeconds * (overtimeRate / 3600));
            }
            
            const currentMonthIncome = monthNormalIncome + monthOvertimeIncome + (overtimeStatus === 'working' ? currentOvertimeIncome - overtimeIncome : 0);
            const monthProgress = (currentMonthIncome / monthlySalary) * 100;
            
            document.getElementById('worked-days').textContent = workedDaysThisMonth;
            document.getElementById('rest-days').textContent = restDaysThisMonth;
            document.getElementById('month-progress').textContent = `${monthProgress.toFixed(1)}%`;
        }
        
        // é‡ç½®æ•°æ®
        function resetData() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‚¨çš„è®¾ç½®å’ŒåŠ ç­è®°å½•ã€‚')) {
                localStorage.removeItem('salaryCalculatorSettings');
                localStorage.removeItem('overtimeData');
                location.reload();
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const settings = localStorage.getItem('salaryCalculatorSettings');
            const overtimeData = localStorage.getItem('overtimeData');
            
            const data = {
                settings: settings ? JSON.parse(settings) : {},
                overtimeData: overtimeData ? JSON.parse(overtimeData) : {},
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `salary_calculator_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        // å¯¼å…¥æ•°æ®
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰çš„è®¾ç½®å’ŒåŠ ç­è®°å½•ã€‚')) {
                        if (data.settings) {
                            localStorage.setItem('salaryCalculatorSettings', JSON.stringify(data.settings));
                        }
                        
                        if (data.overtimeData) {
                            localStorage.setItem('overtimeData', JSON.stringify(data.overtimeData));
                        }
                        
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                        location.reload();
                    }
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ã€‚');
                    console.error('å¯¼å…¥é”™è¯¯:', error);
                }
            };
            
            reader.readAsText(file);
            // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
            event.target.value = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
